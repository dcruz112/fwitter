<script type="text/javascript">  
        $(document).ready(function () {  
            $('.dropdown-toggle').dropdown();  
        });  
</script>

<div class="tweet">
	<%= image_tag(tweet.user.image_url, class: 'tweet-thumbnail') %>
    <div class="tweet-author">
      <strong><%= tweet.user.full_name %></strong>
	    <span class= "author-handle"> <%= link_to tweet.user.handle_at, tweet.user %> </span>
	    <span class= "tweet-time-stamp", title=<%= tweet.updated_at.localtime.asctime.split.join('-') %>>
	    	<%= distance_of_time_in_words_to_now(tweet.updated_at, include_seconds = true) %>
	    </span>
		</div>

		<div class="tweet-content">
	  	<div class="tweet-body">
	  		<% @all_mentions = tweet.all_mentions_in_tweet %>
	  		<% @all_hashes = tweet.all_hashes_in_tweet %>
	  		<% tweet.content.split(' ').each do |word| %>
	  			<% if @all_mentions.include? word %>
	  				<% @user = User.where(handle: word[1..-1]).first %>
	  				<%= link_to word, @user, class: "mention" %>
	  			<% elsif @all_hashes.include? word %>
	  				<%= link_to word, hash_path(word), class: "hashes" %>
	  			<% else %>
	  				<%= word %>
	  			<% end %>
	  		<% end %>
	  	</div>
	 
	  	<div>
	  		<% if tweet.is_retweet %>
	  			<%= "Retweeted by #{User.find(tweet.poster_id).full_name}" %>
	  		<% end %>
	  	</div>

	  	<div class="tweet-footer">
	  		<table>	
        	<td>
        		<div class="dropdown">
        			<a class="dropdown-toggle" data-toggle="dropdown" href="#">Expand</a>
		       		<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
		       			<li>
		       				<table>
		       					<td><%= pluralize("#{tweet.favorited_by.count}", 'Favorite') %></td>
		       					<td><%= pluralize("#{tweet.retweets.count}", "Retweet") %></td>
		       				</table>
		       			</li>
		 	       		<% if tweet.replies.any? %>
		 	       		<li class="divider"></li>
							<h4>Conversation</h4>
			     			<% tweet.replies.each do |post| %>
			     				<%= render post %>
		      				<% end %>
		      			<% end %>
	        		</ul>
	        	</div>
	        </td>

	        <td>
	        	<% if current_user != tweet.user %> 
	        		<% if current_user.favorites.exclude?(tweet) %>
	        			<%= link_to 'Favorite', favorite_tweet_path(tweet, id: tweet.id, type: "favorite", method: :put) %>
	        		<% else %>
	        			<%= link_to 'Un-Favorite', favorite_tweet_path(tweet, type: "unfavorite", method: :put) %>
	        		<% end %>
	        	<% end %>
	        		
	        	<% if (current_user != tweet.user) %>
    				<div class="dropdown">
	    				<a class="dropdown-toggle" data-toggle="dropdown" href="#">Reply</a>
			       		<ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu">
							<li><%= render partial: 'tweets/form_reply', locals: {reply_to: tweet.user.handle} %></li>
						</ul>
					</div>
	        	<% end %> 

	        	<% if (current_user != tweet.user) %>
	        		<%= link_to 'Retweet', retweet_path(tweet) %>	
	        	<% end %> 

        		<% if (current_user != tweet.user && tweet.is_retweet == true) %>
        			<%= link_to 'Un-Retweet', tweet, method: :delete, data: { confirm: 'Are you sure that you would like to un-retweet this tweet?' } %>
        		<% end %> 

        		<% if current_user == tweet.user %>
        			<div class="tweet-delete"><%= link_to 'Delete', tweet, method: :delete, data: { confirm: 'Are you really robbing your words from the world?' } %></div>	
        		<% end %> 
       		</td>
        </table>
	  	</div>
    </div>
</div>
